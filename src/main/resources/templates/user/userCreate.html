<!DOCTYPE html>
<html layout:decorator="~{layout/layout}"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org">

<th:block layout:fragment="content">
    <div class="col-md-6 offset-md-3">
        <!-- form card register -->
        <div class="card card-outline-secondary">
            <div class="card-header">
                <h3 class="mb-0">사용자 생성</h3>
            </div>
            <div class="card-body">
                <form autocomplete="off" class="form" id="updateForm" role="form">
                    <div class="form-group">
                        <label for="username">계정</label>
                        <input class="form-control" id="username" placeholder="계정" required
                               type="text">
                    </div>
                    <div class="form-group">
                        <label for="password">비밀번호</label>
                        <input class="form-control" id="password" placeholder="비밀번호" required type="password">
                    </div>
                    <div class="form-group">
                        <label for="passwordConfirm">비밀번호 확인</label>
                        <input class="form-control" id="passwordConfirm" placeholder="비밀번호 확인" required type="password">
                        <div class="invalid-feedback">
                            비밀번호가 일치하지 않습니다.
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col">
                            <label for="lastName">성</label>
                            <input class="form-control" id="lastName" placeholder="성" required type="text">
                        </div>
                        <div class="col">
                            <label for="firstName">이름</label>
                            <input class="form-control" id="firstName" placeholder="이름" required type="text">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="nickname">별명</label>
                        <input class="form-control" id="nickname" placeholder="별명" required
                               type="text">
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input class="form-control" id="email" placeholder="Email" required
                               type="email">
                    </div>

                    <div class="form-group">
                        <button class="btn btn-primary btn-lg float-right" id="createBtn" type="submit">생성</button>
                    </div>
                </form>
            </div>
        </div>
        <!-- /form card register -->
    </div>

    <script>
        $(function () {
            $('#passwordConfirm').on('input', checkPassword);

            $('#createBtn').on('click', function (e) {
                e.preventDefault();

                benopeUI.confirmModal('사용자 생성', '생성하시겠습니까?', function () {
                    var createUserRequest = {
                        username: $('#username').val(),
                        password: $('#password').val(),
                        firstName: $('#firstName').val(),
                        lastName: $('#lastName').val(),
                        nickname: $('#nickname').val(),
                        email: $('#email').val()
                    };

                    isValidPassword() &&
                    benopeAPI.createUser(createUserRequest)
                        .then(function () {
                            benopeUI.confirmModal('사용자 생성', '생성되었습니다.');
                        }).catch(function (e) {
                        benopeUI.confirmModal('사용자 생성', e.message)
                    });
                });
            });
        });

        function checkPassword() {
            if (isValidPassword()) {
                $(this).removeClass('is-invalid');
            } else {
                $(this).addClass('is-invalid');
            }
        }

        function isValidPassword() {
            var password = $('#password').val();
            var passwordConfirm = $('#passwordConfirm').val();
            return password === passwordConfirm;
        }
    </script>
</th:block>

</html>